<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>نظام التقييم | YLY</title>
  <!-- الموارد المشتركة -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <style>
    :root {
      --primary-color: #2b68ff;
      --primary-hover: #1c4de1;
      --accent-color: #ffc107;
      --text-color: #fff;
      --bg-overlay: rgba(0, 0, 50, 0.4);
      --form-bg: rgba(255, 255, 255, 0.1);
      --input-bg: rgba(255,255,255,0.2);
      --input-hover: rgba(255,255,255,0.3);
      --border-radius: 14px;
      --card-bg: rgba(255, 255, 255, 0.08);
      --success-color: #28a745;
      --danger-color: #dc3545;
      --warning-color: #fd7e14;
      --secondary-color: #6c757d;
    }
    
    body {
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(rgba(0, 0, 30, 0.8), rgba(0, 0, 50, 0.9)), url(./assets/bg-space.jpg.png) no-repeat center center fixed;
      background-size: cover;
      color: var(--text-color);
      min-height: 100vh;
      margin: 0;
      padding: 0;
      position: relative;
    }
    
    /* تأثير الجسيمات في الخلفية */
    #particles-js {
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: -1;
      background-color: transparent;
    }
    
    .overlay {
      width: 100vw;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      z-index: -2;
    }
    
    /* الشريط العلوي مع القائمة المنسدلة */
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 30px;
      background: rgba(0, 0, 0, 0.3);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .logo-section {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .logo-section img {
      height: 50px;
      transition: transform 0.3s;
      cursor: pointer;
    }
    
    .logo-section img:hover {
      transform: scale(1.05);
    }
    
    .season-title {
      font-size: 1.4em;
      font-weight: 700;
      color: var(--accent-color);
      cursor: pointer;
    }
    
    .user-section {
      display: flex;
      align-items: center;
      gap: 20px;
      position: relative;
    }
    
    .language-toggle {
      background: rgba(255,255,255,0.2);
      padding: 8px 15px;
      border-radius: var(--border-radius);
      color: white;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
      border: 1px solid rgba(255,255,255,0.3);
    }
    
    .language-toggle:hover {
      background: rgba(255,255,255,0.3);
    }
    
    .user-avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      object-fit: cover;
      cursor: pointer;
      border: 2px solid var(--accent-color);
      transition: all 0.3s;
    }
    
    .user-avatar:hover {
      transform: scale(1.1);
    }
    
    /* القائمة المنسدلة لمدير النظام */
    .user-dropdown {
      position: absolute;
      top: 60px;
      left: 0;
      background: rgba(0, 0, 0, 0.9);
      border-radius: var(--border-radius);
      padding: 20px;
      width: 250px;
      display: none;
      box-shadow: 0 10px 25px rgba(0,0,0,0.5);
      border: 1px solid rgba(255,255,255,0.1);
      z-index: 101;
    }
    
    .user-dropdown.show {
      display: block;
      animation: fadeIn 0.3s;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .user-info {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .user-dropdown-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid var(--primary-color);
    }
    
    .user-name {
      font-size: 1.2em;
      font-weight: 600;
    }
    
    .user-role {
      color: var(--accent-color);
      font-size: 0.9em;
    }
    
    .dropdown-btn {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      border-radius: var(--border-radius);
      background: rgba(255,255,255,0.1);
      border: none;
      color: white;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .dropdown-btn:hover {
      background: var(--primary-color);
    }
    
    /* شريط التنقل */
    .nav-bar {
      display: flex;
      justify-content: center;
      background: rgba(0, 0, 0, 0.2);
      padding: 10px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      overflow-x: auto;
    }
    
    .nav-link {
      padding: 10px 20px;
      margin: 0 5px;
      color: white;
      text-decoration: none;
      font-weight: 600;
      border-radius: var(--border-radius);
      transition: all 0.3s;
      position: relative;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .nav-link:hover, .nav-link.active {
      background: var(--primary-color);
    }
    
    .nav-link:hover::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 5px solid transparent;
      border-right: 5px solid transparent;
      border-top: 5px solid var(--primary-color);
    }
    
    /* المحتوى الرئيسي */
    .main-content {
      padding: 30px;
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .section-title {
      font-size: 1.8em;
      margin-bottom: 25px;
      color: var(--accent-color);
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .evaluation-container {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 25px;
      margin-bottom: 30px;
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    
    .evaluation-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .search-box {
      display: flex;
      align-items: center;
      background: rgba(255,255,255,0.1);
      border-radius: var(--border-radius);
      padding: 8px 15px;
      min-width: 300px;
      transition: all 0.3s;
    }
    
    .search-box:hover {
      background: rgba(255,255,255,0.2);
    }
    
    .search-box input {
      background: transparent;
      border: none;
      color: white;
      padding: 5px;
      width: 100%;
      font-family: 'Cairo', sans-serif;
    }
    
    .export-import {
      display: flex;
      gap: 10px;
    }
    
    .control-btn {
      padding: 12px 20px;
      border-radius: var(--border-radius);
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-primary {
      background-color: var(--primary-color);
      color: white;
    }
    
    .btn-primary:hover {
      background-color: var(--primary-hover);
      transform: translateY(-2px);
      box-shadow: 0 5px 10px rgba(0,0,0,0.2);
    }
    
    .btn-secondary {
      background-color: var(--secondary-color);
      color: white;
    }
    
    .btn-secondary:hover {
      background-color: #5a6268;
      transform: translateY(-2px);
      box-shadow: 0 5px 10px rgba(0,0,0,0.2);
    }
    
    .btn-success {
      background-color: var(--success-color);
      color: white;
    }
    
    .btn-success:hover {
      background-color: #218838;
      transform: translateY(-2px);
      box-shadow: 0 5px 10px rgba(0,0,0,0.2);
    }
    
    .btn-danger {
      background-color: var(--danger-color);
      color: white;
    }
    
    .btn-danger:hover {
      background-color: #c82333;
      transform: translateY(-2px);
      box-shadow: 0 5px 10px rgba(0,0,0,0.2);
    }
    
    .btn-warning {
      background-color: var(--warning-color);
      color: white;
    }
    
    .btn-warning:hover {
      background-color: #e0a800;
      transform: translateY(-2px);
      box-shadow: 0 5px 10px rgba(0,0,0,0.2);
    }
    
    .btn-info {
      background-color: #17a2b8;
      color: white;
    }
    
    .btn-info:hover {
      background-color: #138496;
      transform: translateY(-2px);
      box-shadow: 0 5px 10px rgba(0,0,0,0.2);
    }
    
    .form-control {
      width: 100%;
      padding: 10px 12px;
      border-radius: var(--border-radius);
      border: 1px solid rgba(255,255,255,0.2);
      background: var(--input-bg);
      color: white;
      font-family: 'Cairo', sans-serif;
      transition: all 0.3s;
    }
    
    .form-control:hover {
      background: var(--input-hover);
    }
    
    .form-control:focus {
      outline: none;
      border-color: var(--primary-color);
      background: var(--input-hover);
      box-shadow: 0 0 0 2px rgba(43, 104, 255, 0.2);
    }
    
    .form-section {
      margin-bottom: 25px;
      padding: 15px;
      background: rgba(0, 0, 0, 0.1);
      border-radius: var(--border-radius);
      transition: all 0.3s;
    }
    
    .form-section:hover {
      background: rgba(0, 0, 0, 0.2);
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    }
    
    .form-section-title {
      font-size: 1.2em;
      margin-bottom: 15px;
      color: var(--accent-color);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
    }
    
    .evaluation-table {
      overflow-x: auto;
      margin-bottom: 15px;
      background: rgba(0,0,0,0.2);
      border-radius: var(--border-radius);
      padding: 10px;
    }
    
    .evaluation-table table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .evaluation-table th, 
    .evaluation-table td {
      padding: 12px 15px;
      text-align: right;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .evaluation-table th {
      background: rgba(0,0,0,0.3);
      font-weight: 600;
      color: var(--accent-color);
    }
    
    .evaluation-table tfoot {
      font-weight: bold;
      background: rgba(0,0,0,0.2);
    }
    
    .add-field-btn {
      background: rgba(255,255,255,0.1);
      border: none;
      color: var(--accent-color);
      padding: 8px 15px;
      border-radius: var(--border-radius);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 8px;
      transition: all 0.2s;
    }
    
    .add-field-btn:hover {
      background: rgba(255,255,255,0.2);
      transform: translateY(-2px);
    }
    
    .action-btn {
      background: transparent;
      border: none;
      color: white;
      cursor: pointer;
      margin: 0 5px;
      font-size: 1.1em;
      transition: all 0.3s;
    }
    
    .action-btn.delete {
      color: var(--danger-color);
    }
    
    .action-btn:hover {
      transform: scale(1.2);
    }
    
    .total-section {
      background: rgba(0,0,0,0.3);
      border-left: 3px solid var(--accent-color);
      padding: 15px;
    }
    
    .total-display, .total-grade {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .total-label, .grade-label {
      font-weight: 600;
    }
    
    .total-value {
      font-size: 1.5em;
      font-weight: bold;
      color: var(--accent-color);
    }
    
    .grade-value {
      font-size: 1.3em;
      font-weight: bold;
      color: var(--primary-color);
    }
    
    .form-actions {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 25px;
      flex-wrap: wrap;
    }
    
    .bonus-controls {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    
    .bonus-controls input {
      flex: 1;
    }
    
    .remove-bonus {
      background: transparent;
      border: none;
      color: var(--danger-color);
      cursor: pointer;
      font-size: 1.1em;
    }
    
    /* شخصية بيلو */
    .bilo-container {
      position: fixed;
      bottom: 30px;
      left: 30px;
      z-index: 99;
    }
    
    .bilo-img {
      width: 120px;
      cursor: pointer;
      transition: all 0.3s;
      filter: drop-shadow(0 5px 15px rgba(0,0,0,0.5));
    }
    
    .bilo-img:hover {
      transform: scale(1.1) rotate(-5deg);
    }
    
    .bilo-speech {
      position: absolute;
      bottom: 140px;
      left: 50px;
      background: rgba(255, 255, 255, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.4);
      border-radius: var(--border-radius);
      padding: 15px;
      width: 250px;
      font-size: 0.95em;
      display: none;
      backdrop-filter: blur(5px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      animation: float 3s ease-in-out infinite;
    }
    
    .bilo-speech.show {
      display: block;
      animation: appear 0.3s ease-out, float 3s ease-in-out infinite;
    }
    
    .bilo-speech::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 30px;
      border-width: 10px 10px 0;
      border-style: solid;
      border-color: rgba(255, 255, 255, 0.15) transparent;
    }
    
    @keyframes appear {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-5px); }
      100% { transform: translateY(0px); }
    }
    
    /* التجاوب مع أحجام الشاشات */
    @media (max-width: 992px) {
      .form-grid {
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      }
      
      .evaluation-controls {
        flex-direction: column;
      }
      
      .search-box {
        width: 100%;
      }
      
      .export-import {
        width: 100%;
        justify-content: space-between;
      }
      
      .export-import .control-btn {
        flex: 1;
        text-align: center;
        justify-content: center;
      }
    }
    
    @media (max-width: 768px) {
      .top-bar {
        padding: 10px 15px;
      }
      
      .logo-section img {
        height: 40px;
      }
      
      .season-title {
        font-size: 1.1em;
      }
      
      .user-avatar {
        width: 40px;
        height: 40px;
      }
      
      .nav-bar {
        justify-content: flex-start;
        padding: 10px 5px;
      }
      
      .nav-link {
        padding: 8px 15px;
        font-size: 0.9em;
      }
      
      .main-content {
        padding: 20px 15px;
      }
      
      .form-grid {
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 10px;
      }
      
      .form-actions {
        flex-direction: column;
      }
      
      .form-actions button {
        width: 100%;
      }
      
      .bilo-container {
        bottom: 20px;
        left: 20px;
      }
      
      .bilo-img {
        width: 90px;
      }
      
      .bilo-speech {
        width: 200px;
        left: 40px;
        bottom: 110px;
      }
    }
    
    @media (max-width: 576px) {
      .logo-section {
        flex-direction: column;
        gap: 5px;
        align-items: flex-start;
      }
      
      .season-title {
        font-size: 1em;
      }
      
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .evaluation-table table {
        font-size: 0.9em;
      }
      
      .evaluation-table th, 
      .evaluation-table td {
        padding: 8px 10px;
      }
    }
    
    @media print {
      body * {
        visibility: hidden;
      }
      .evaluation-container, .evaluation-container * {
        visibility: visible;
      }
      .evaluation-container {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        background: white;
        color: black;
        padding: 20px;
      }
      .no-print {
        display: none !important;
      }
    }
  </style>
</head>
<body>
<!-- تأثير الجسيمات في الخلفية -->
<div id="particles-js"></div>
<div class="overlay"></div>

<!-- الشريط العلوي مع القائمة المنسدلة -->
<div class="top-bar">
  <div class="logo-section">
    <img src="assets/logo-ministry.png" alt="وزارة الشباب والرياضة" 
         onmouseover="showBiloMessage('دي شعار وزارة الشباب والرياضة، الشريك الرسمي للمشروع')"
         onmouseout="hideBiloMessage()">
    <img src="assets/logo-yly.png" alt="YLY"
         onmouseover="showBiloMessage('ده شعار مشروع YLY، مشروعنا العظيم اللي بنطوره مع بعض')"
         onmouseout="hideBiloMessage()">
    <div class="season-title" 
         onmouseover="showBiloMessage('ده رقم الموسم الحالي، كل سنة بنزود رقم وبنطور النظام')"
         onmouseout="hideBiloMessage()">YLY - PORT SAID SEASON <span id="season-number">7</span></div>
  </div>
  
  <div class="user-section">
    <div class="language-toggle" onclick="toggleLanguage()"
         onmouseover="showBiloMessage('دوس هنا لو عاوز تغير اللغة من عربي لإنجليزي والعكس')"
         onmouseout="hideBiloMessage()">
      <i class="fas fa-language"></i>
      <span>العربية / English</span>
    </div>
    
    <img src="assets/SAAD.jpg" alt="صورة المستخدم" class="user-avatar" id="user-avatar"
         onmouseover="showBiloMessage('دوس هنا علشان تشوف بياناتك أو تسجل الخروج')"
         onmouseout="hideBiloMessage()">
    
    <div class="user-dropdown" id="user-dropdown">
      <div class="user-info">
        <img src="assets/SAAD.jpg" alt="صورة المستخدم" class="user-dropdown-avatar">
        <div class="user-name" id="dropdown-username">سعد المرجاوي</div>
        <div class="user-role" id="dropdown-userrole">مدير النظام</div>
      </div>
      
      <button class="dropdown-btn" onclick="openSettings()">
        <i class="fas fa-cog"></i> الإعدادات
      </button>
      <button class="dropdown-btn" onclick="logout()">
        <i class="fas fa-sign-out-alt"></i> تسجيل الخروج
      </button>
    </div>
  </div>
</div>

<!-- شريط التنقل -->
<div class="nav-bar">
  <a href="home.html" class="nav-link"
     onmouseover="showBiloMessage('الصفحة الرئيسية فيها كل الإحصائيات والهيكل التنظيمي')"
     onmouseout="hideBiloMessage()"><i class="fas fa-home"></i> الصفحة الرئيسية</a>
  <a href="volunteers.html" class="nav-link"
     onmouseover="showBiloMessage('صفحة إدارة المتطوعين علشان تضيف أو تعدل أو تشوف بيانات المتطوعين')"
     onmouseout="hideBiloMessage()"><i class="fas fa-users"></i> إدارة المتطوعين</a>
  <a href="evaluations.html" class="nav-link active"
     onmouseover="showBiloMessage('هنا بتقيم المتطوعين وتشوف التقييمات السابقة')"
     onmouseout="hideBiloMessage()"><i class="fas fa-star"></i> إدارة التقييمات</a>
  <a href="reports.html" class="nav-link"
     onmouseover="showBiloMessage('التقارير بتاعت المشروع وإحصائيات مفصلة عن كل حاجة')"
     onmouseout="hideBiloMessage()"><i class="fas fa-chart-bar"></i> التقارير</a>
  <a href="role.system.html" class="nav-link"
     onmouseover="showBiloMessage('قواعد النظام والسياسات المتبعة في المشروع')"
     onmouseout="hideBiloMessage()"><i class="fas fa-info-circle"></i> قواعد النظام</a>
  <a href="support.html" class="nav-link"
     onmouseover="showBiloMessage('لو عندك أي مشكلة أو استفسار، كلمنا من هنا')"
     onmouseout="hideBiloMessage()"><i class="fas fa-headset"></i> تواصل معنا</a>
</div>

<!-- المحتوى الرئيسي -->
<div class="main-content">
  <div class="section-title" 
       onmouseover="showBiloMessage('صفحة تقييم المتطوعين - هنا يمكنك تقييم الأداء حسب المعايير المحددة', 'info')"
       onmouseout="hideBiloMessage()">
    <i class="fas fa-star"></i>
    <h2>نظام تقييم المتطوعين</h2>
  </div>

  <div class="evaluation-container">
    <div class="evaluation-controls">
      <div class="search-box"
           onmouseover="showBiloMessage('ابحث عن المتطوع بالاسم أو رقم ID أو الرقم القومي', 'info')"
           onmouseout="hideBiloMessage()">
        <i class="fas fa-search"></i>
        <input type="text" placeholder="ابحث باسم المتطوع أو ID أو الرقم القومي..." id="volunteer-search">
      </div>
      
      <div class="export-import">
        <button class="control-btn btn-primary" id="export-evaluations"
                onmouseover="showBiloMessage('تصدير جميع التقييمات لملف Excel - لحفظ نسخة احتياطية', 'info')"
                onmouseout="hideBiloMessage()">
          <i class="fas fa-file-export"></i> تصدير التقييمات
        </button>
        <button class="control-btn btn-secondary" id="import-evaluations"
                onmouseover="showBiloMessage('استيراد تقييمات من ملف Excel - لاستعادة البيانات', 'info')"
                onmouseout="hideBiloMessage()">
          <i class="fas fa-file-import"></i> استيراد تقييمات
        </button>
      </div>
    </div>

    <div class="evaluation-form-container">
      <form id="evaluation-form">
        <div class="form-section">
          <div class="form-section-title">
            <i class="fas fa-user"></i>
            <h3>بيانات المتطوع</h3>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="volunteer-name">اسم المتطوع</label>
              <select id="volunteer-name" class="form-control" required
                      onmouseover="showBiloMessage('اختر المتطوع الذي تريد تقييمه من القائمة', 'info')"
                      onmouseout="hideBiloMessage()">
                <option value="">اختر المتطوع</option>
                <option value="YLY-2023-001">ريم عاشور (YLY-2023-001) - 29801011501234</option>
                <option value="YLY-2023-002">أحمد محمد (YLY-2023-002) - 29902021502345</option>
                <option value="YLY-2023-003">مريم خالد (YLY-2023-003) - 30003101503456</option>
                <option value="YLY-2023-004">علي محمود (YLY-2023-004) - 30104211504567</option>
              </select>
            </div>
            <div class="form-group">
              <label for="evaluation-month">شهر التقييم</label>
              <select id="evaluation-month" class="form-control" required
                      onmouseover="showBiloMessage('حدد شهر التقييم المناسب - يمكن تقييم كل شهر مرة واحدة فقط', 'info')"
                      onmouseout="hideBiloMessage()">
                <option value="1">يناير</option>
                <option value="2" selected>فبراير</option>
                <option value="3">مارس</option>
                <option value="4">أبريل</option>
                <option value="5">مايو</option>
                <option value="6">يونيو</option>
                <option value="7">يوليو</option>
                <option value="8">أغسطس</option>
                <option value="9">سبتمبر</option>
                <option value="10">أكتوبر</option>
                <option value="11">نوفمبر</option>
                <option value="12">ديسمبر</option>
              </select>
            </div>
          </div>
        </div>

        <!-- قسم المهام -->
        <div class="form-section">
          <div class="form-section-title">
            <i class="fas fa-tasks"></i>
            <h3>المهام (30 نقطة)</h3>
          </div>
          <div class="evaluation-table">
            <table>
              <thead>
                <tr>
                  <th>المهمة</th>
                  <th>النقاط (20)</th>
                  <th>الالتزام بالمواعيد (10)</th>
                  <th>إعفاء</th>
                  <th>إجراء</th>
                </tr>
              </thead>
              <tbody id="tasks-container">
                <tr class="evaluation-row">
                  <td><input type="text" class="form-control task-name" placeholder="وصف المهمة"
                             onmouseover="showBiloMessage('أدخل وصفاً واضحاً للمهمة المكلف بها المتطوع', 'info')"
                             onmouseout="hideBiloMessage()"></td>
                  <td><input type="number" class="form-control task-points" min="0" max="20" value="0"
                             onmouseover="showBiloMessage('تقييم أداء المتطوع في تنفيذ المهمة من 20 نقطة', 'info')"
                             onmouseout="hideBiloMessage()"></td>
                  <td><input type="number" class="form-control deadline-points" min="0" max="10" value="0"
                             onmouseover="showBiloMessage('تقييم التزام المتطوع بالمواعيد المحددة من 10 نقاط', 'info')"
                             onmouseout="hideBiloMessage()"></td>
                  <td><input type="checkbox" class="excuse-checkbox"
                             onmouseover="showBiloMessage('حدد إذا كان المتطوع لديه عذر مقبول (يحصل على نصف النقاط)', 'warning')"
                             onmouseout="hideBiloMessage()"></td>
                  <td>
                    <button type="button" class="action-btn delete" onclick="this.closest('tr').remove(); calculateTotals();"
                            onmouseover="showBiloMessage('حذف هذه المهمة من التقييم', 'danger')"
                            onmouseout="hideBiloMessage()">
                      <i class="fas fa-trash"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
              <tfoot>
                <tr>
                  <td><strong>المجموع</strong></td>
                  <td><span id="tasks-total">0</span>/20</td>
                  <td><span id="deadline-total">0</span>/10</td>
                  <td><span id="tasks-excuse-total">0</span> إعفاء</td>
                  <td></td>
                </tr>
              </tfoot>
            </table>
            <button type="button" class="add-field-btn" id="add-task-btn"
                    onmouseover="showBiloMessage('إضافة مهمة جديدة - 20 نقطة للأداء + 10 للالتزام بالمواعيد. عند الإعفاء يحصل على نصف النقاط فقط.', 'info')"
                    onmouseout="hideBiloMessage()">
              <i class="fas fa-plus"></i> إضافة مهمة
            </button>
          </div>
        </div>

        <!-- قسم الفعاليات -->
        <div class="form-section">
          <div class="form-section-title">
            <i class="fas fa-calendar-alt"></i>
            <h3>الفعاليات (20 نقطة)</h3>
          </div>
          <div class="evaluation-table">
            <table>
              <thead>
                <tr>
                  <th>التاريخ</th>
                  <th>اسم الفعالية</th>
                  <th>النقاط (15)</th>
                  <th>اليونيفورم (5)</th>
                  <th>إعفاء</th>
                  <th>إجراء</th>
                </tr>
              </thead>
              <tbody id="events-container">
                <tr class="evaluation-row">
                  <td><input type="date" class="form-control event-date" value="2025-02-01"
                             onmouseover="showBiloMessage('حدد تاريخ الفعالية التي حضرها المتطوع', 'info')"
                             onmouseout="hideBiloMessage()"></td>
                  <td><input type="text" class="form-control event-name" placeholder="اسم الفعالية"
                              onmouseover="showBiloMessage('أدخل اسم الفعالية أو الحدث الذي حضره المتطوع', 'info')"
                              onmouseout="hideBiloMessage()"></td>
                  <td><input type="number" class="form-control event-points" min="0" max="15" value="0"
                             onmouseover="showBiloMessage('تقييم حضور المتطوع للفعالية وتفاعله فيها من 15 نقطة', 'info')"
                             onmouseout="hideBiloMessage()"></td>
                  <td><input type="number" class="form-control uniform-points" min="0" max="5" value="0"
                             onmouseover="showBiloMessage('تقييم التزام المتطوع باليونيفورم الرسمي من 5 نقاط', 'info')"
                             onmouseout="hideBiloMessage()"></td>
                  <td><input type="checkbox" class="excuse-checkbox"
                             onmouseover="showBiloMessage('حدد إذا كان المتطوع لديه عذر مقبول لغيابه (يحصل على نصف النقاط)', 'warning')"
                             onmouseout="hideBiloMessage()"></td>
                  <td>
                    <button type="button" class="action-btn delete" onclick="this.closest('tr').remove(); calculateTotals();"
                            onmouseover="showBiloMessage('حذف هذه الفعالية من التقييم', 'danger')"
                            onmouseout="hideBiloMessage()">
                      <i class="fas fa-trash"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
              <tfoot>
                <tr>
                  <td colspan="2"><strong>المجموع</strong></td>
                  <td><span id="events-total">0</span>/15</td>
                  <td><span id="uniform-total">0</span>/5</td>
                  <td><span id="events-excuse-total">0</span> إعفاء</td>
                  <td></td>
                </tr>
              </tfoot>
            </table>
            <button type="button" class="add-field-btn" id="add-event-btn"
                    onmouseover="showBiloMessage('إضافة فعالية جديدة - 15 نقطة للحضور + 5 لليونيفورم. عند الإعفاء يحصل على نصف النقاط فقط.', 'info')"
                    onmouseout="hideBiloMessage()">
              <i class="fas fa-plus"></i> إضافة فعالية
            </button>
          </div>
        </div>

        <!-- قسم الاجتماعات -->
        <div class="form-section">
          <div class="form-section-title">
            <i class="fas fa-users"></i>
            <h3>الاجتماعات (20 نقطة)</h3>
          </div>
          <div class="evaluation-table">
            <table>
              <thead>
                <tr>
                  <th>التاريخ</th>
                  <th>نوع الاجتماع</th>
                  <th>النقاط</th>
                  <th>إعفاء</th>
                  <th>إجراء</th>
                </tr>
              </thead>
              <tbody id="meetings-container">
                <tr class="evaluation-row">
                  <td><input type="date" class="form-control meeting-date" value="2025-02-01"
                             onmouseover="showBiloMessage('حدد تاريخ الاجتماع الذي حضره المتطوع', 'info')"
                             onmouseout="hideBiloMessage()"></td>
                  <td><input type="text" class="form-control meeting-type" placeholder="نوع الاجتماع"
                             onmouseover="showBiloMessage('أدخل نوع الاجتماع (إسبوعي - طارئ - تخطيطي)', 'info')"
                             onmouseout="hideBiloMessage()"></td>
                  <td><input type="number" class="form-control meeting-points" min="0" max="10" value="0"
                             onmouseover="showBiloMessage('تقييم حضور المتطوع للاجتماع وتفاعله فيه من 10 نقاط', 'info')"
                             onmouseout="hideBiloMessage()"></td>
                  <td><input type="checkbox" class="excuse-checkbox"
                             onmouseover="showBiloMessage('حدد إذا كان المتطوع لديه عذر مقبول لغيابه (يحصل على نصف النقاط)', 'warning')"
                             onmouseout="hideBiloMessage()"></td>
                  <td>
                    <button type="button" class="action-btn delete" onclick="this.closest('tr').remove(); calculateTotals();"
                            onmouseover="showBiloMessage('حذف هذا الاجتماع من التقييم', 'danger')"
                            onmouseout="hideBiloMessage()">
                      <i class="fas fa-trash"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
              <tfoot>
                <tr>
                  <td colspan="2"><strong>المجموع</strong></td>
                  <td><span id="meetings-total">0</span>/20</td>
                  <td><span id="meetings-excuse-total">0</span> إعفاء</td>
                  <td></td>
                </tr>
              </tfoot>
            </table>
            <button type="button" class="add-field-btn" id="add-meeting-btn"
                    onmouseover="showBiloMessage('إضافة اجتماع جديد - 10 نقاط لكل اجتماع. عند الإعفاء يحصل على نصف النقاط فقط.', 'info')"
                    onmouseout="hideBiloMessage()">
              <i class="fas fa-plus"></i> إضافة اجتماع
            </button>
          </div>
        </div>

        <!-- قسم التفاعل والأفكار -->
        <div class="form-section">
          <div class="form-section-title">
            <i class="fas fa-lightbulb"></i>
            <h3>التفاعل والأفكار (15 نقطة)</h3>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="group-activity">التفاعل في الجروب (5)</label>
              <input type="number" id="group-activity" class="form-control" min="0" max="5" value="0"
                     onmouseover="showBiloMessage('تقييم تفاعل المتطوع في المجموعات والمناقشات (التواصل الفعال - المشاركة)', 'info')"
                     onmouseout="hideBiloMessage()">
            </div>
            <div class="form-group">
              <label for="hr-follow">متابعة HR (5)</label>
              <input type="number" id="hr-follow" class="form-control" min="0" max="5" value="0"
                     onmouseover="showBiloMessage('تقييم مدى متابعة المتطوع لتوجيهات الموارد البشرية (الرد على الرسائل - تنفيذ التعليمات)', 'info')"
                     onmouseout="hideBiloMessage()">
            </div>
            <div class="form-group">
              <label for="ideas">الأفكار والاقتراحات (5)</label>
              <input type="number" id="ideas" class="form-control" min="0" max="5" value="0"
                     onmouseover="showBiloMessage('تقييم الأفكار والإقتراحات المقدمة من المتطوع (الإبداع - الجدوى - التطبيق)', 'info')"
                     onmouseout="hideBiloMessage()">
            </div>
          </div>
        </div>

        <!-- قسم السلوك -->
        <div class="form-section">
          <div class="form-section-title">
            <i class="fas fa-user-shield"></i>
            <h3>السلوك (15 نقطة)</h3>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="behavior">السلوك العام (10)</label>
              <input type="number" id="behavior" class="form-control" min="0" max="10" value="0"
                     onmouseover="showBiloMessage('تقييم السلوك العام والأخلاقيات المهنية للمتطوع (الاحترام - التعاون - الالتزام)', 'info')"
                     onmouseout="hideBiloMessage()">
            </div>
            <div class="form-group">
              <label for="hierarchy">احترام الهيكل التنظيمي (5)</label>
              <input type="number" id="hierarchy" class="form-control" min="0" max="5" value="0"
                     onmouseover="showBiloMessage('تقييم مدى احترام المتطوع للهيكل التنظيمي والمسؤولين (التسلسل القيادي - تنفيذ الأوامر)', 'info')"
                     onmouseout="hideBiloMessage()">
            </div>
          </div>
        </div>

        <!-- البونص -->
        <div class="form-section">
          <div class="form-section-title">
            <i class="fas fa-gift"></i>
            <h3>البونص الإضافي</h3>
          </div>
          <div class="form-grid" id="bonus-container">
            <!-- سيتم إضافته ديناميكياً -->
          </div>
          <button type="button" class="add-field-btn" id="add-bonus-btn"
                  onmouseover="showBiloMessage('إضافة نقاط بونص للمتطوع المتميز (مهام إضافية - مبادرات - تميز)', 'info')"
                  onmouseout="hideBiloMessage()">
            <i class="fas fa-plus"></i> إضافة بونص
          </button>
        </div>

        <!-- المجموع الكلي -->
        <div class="form-section total-section">
          <div class="total-display">
            <div class="total-label">المجموع الكلي:</div>
            <div class="total-value"><span id="grand-total">0</span>/100</div>
          </div>
          <div class="total-grade">
            <div class="grade-label">التقدير:</div>
            <div class="grade-value" id="final-grade">غير محسوب</div>
          </div>
        </div>

        <!-- ملاحظات -->
        <div class="form-section">
          <div class="form-section-title">
            <i class="fas fa-comment-alt"></i>
            <h3>ملاحظات التقييم</h3>
          </div>
          <textarea id="evaluation-notes" class="form-control" rows="3" 
                    placeholder="أي ملاحظات إضافية عن أداء المتطوع..."
                    onmouseover="showBiloMessage('أدخل أي ملاحظات إضافية عن أداء المتطوع (نقاط القوة - نقاط الضعف - توصيات)', 'info')"
                    onmouseout="hideBiloMessage()"></textarea>
        </div>

        <!-- أزرار التحكم -->
        <div class="form-actions">
          <button type="button" class="control-btn btn-primary" id="save-evaluation"
                  onmouseover="showBiloMessage('حفظ التقييم في قاعدة البيانات - تأكد من تعبئة جميع الحقول المطلوبة', 'info')"
                  onmouseout="hideBiloMessage()">
            <i class="fas fa-save"></i> حفظ التقييم
          </button>
          <button type="button" class="control-btn btn-success" id="print-evaluation"
                  onmouseover="showBiloMessage('طباعة التقييم كملف PDF أو ورق - لحفظ سجل رسمي', 'info')"
                  onmouseout="hideBiloMessage()">
            <i class="fas fa-print"></i> طباعة التقييم
          </button>
          <button type="button" class="control-btn btn-info" id="share-evaluation"
                  onmouseover="showBiloMessage('مشاركة التقييم مع المسؤولين أو المتطوع عبر البريد الإلكتروني', 'info')"
                  onmouseout="hideBiloMessage()">
            <i class="fas fa-share-alt"></i> مشاركة التقييم
          </button>
          <button type="button" class="control-btn btn-danger" id="clear-form"
                  onmouseover="showBiloMessage('مسح النموذج الحالي والبدء من جديد - سيتم فقدان جميع البيانات غير المحفوظة', 'warning')"
                  onmouseout="hideBiloMessage()">
            <i class="fas fa-trash"></i> مسح النموذج
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- شخصية بيلو -->
<div class="bilo-container">
  <img src="assets/bilo-happy.png" alt="بيلو" class="bilo-img" id="bilo-img" onclick="biloClick()">
  <div class="bilo-speech" id="bilo-speech">مرحباً بك في نظام التقييم! يمكنني مساعدتك في فهم كيفية تقييم المتطوعين.</div>
</div>

<script>
  // تهيئة تأثير الجسيمات في الخلفية
  document.addEventListener('DOMContentLoaded', function() {
    if (typeof particlesJS !== 'undefined') {
      particlesJS('particles-js', {
        "particles": {
          "number": {
            "value": 80,
            "density": {
              "enable": true,
              "value_area": 800
            }
          },
          "color": {
            "value": "#ffffff"
          },
          "shape": {
            "type": "circle",
            "stroke": {
              "width": 0,
              "color": "#000000"
            },
            "polygon": {
              "nb_sides": 5
            }
          },
          "opacity": {
            "value": 0.5,
            "random": false,
            "anim": {
              "enable": false,
              "speed": 1,
              "opacity_min": 0.1,
              "sync": false
            }
          },
          "size": {
            "value": 3,
            "random": true,
            "anim": {
              "enable": false,
              "speed": 40,
              "size_min": 0.1,
              "sync": false
            }
          },
          "line_linked": {
            "enable": true,
            "distance": 150,
            "color": "#ffffff",
            "opacity": 0.4,
            "width": 1
          },
          "move": {
            "enable": true,
            "speed": 2,
            "direction": "none",
            "random": false,
            "straight": false,
            "out_mode": "out",
            "bounce": false,
            "attract": {
              "enable": false,
              "rotateX": 600,
              "rotateY": 1200
            }
          }
        },
        "interactivity": {
          "detect_on": "canvas",
          "events": {
            "onhover": {
              "enable": true,
              "mode": "grab"
            },
            "onclick": {
              "enable": true,
              "mode": "push"
            },
            "resize": true
          },
          "modes": {
            "grab": {
              "distance": 140,
              "line_linked": {
                "opacity": 1
              }
            },
            "bubble": {
              "distance": 400,
              "size": 40,
              "duration": 2,
              "opacity": 8,
              "speed": 3
            },
            "repulse": {
              "distance": 200,
              "duration": 0.4
            },
            "push": {
              "particles_nb": 4
            },
            "remove": {
              "particles_nb": 2
            }
          }
        },
        "retina_detect": true
      });
    } else {
      console.error('particlesJS library not loaded');
    }

    // تعيين بيانات المستخدم
    document.getElementById('dropdown-username').textContent = "سعد المرجاوي";
    document.getElementById('dropdown-userrole').textContent = "مدير النظام";
    document.getElementById('season-number').textContent = "7";
    
    // إضافة مستمعين للأحداث
    document.getElementById('user-avatar').addEventListener('click', function(e) {
      e.stopPropagation();
      document.getElementById('user-dropdown').classList.toggle('show');
    });

    window.addEventListener('click', function() {
      const dropdown = document.getElementById('user-dropdown');
      if (dropdown.classList.contains('show')) {
        dropdown.classList.remove('show');
      }
    });
    
    // حساب المجاميع الأولية
    calculateTotals();
  });

  // تبديل اللغة
  function toggleLanguage() {
    const currentLang = document.documentElement.lang;
    if (currentLang === 'ar') {
      document.documentElement.lang = 'en';
      document.documentElement.dir = 'ltr';
      document.querySelector('.language-toggle span').textContent = 'English / العربية';
      document.title = 'Evaluation System | YLY';
    } else {
      document.documentElement.lang = 'ar';
      document.documentElement.dir = 'rtl';
      document.querySelector('.language-toggle span').textContent = 'العربية / English';
      document.title = 'نظام التقييم | YLY';
    }
  }

  // فتح الإعدادات
  function openSettings() {
    window.location.href = 'settings.html';
  }

  // تسجيل الخروج
  function logout() {
    if (confirm("هل أنت متأكد من تسجيل الخروج؟")) {
      window.location.href = "login.html";
    }
  }

  // بيانات المتطوعين
  const volunteersData = {
    "YLY-2023-001": {
      name: "ريم عاشور",
      committee: "HEAD",
      role: "ليدر المحافظة",
      nationalId: "29801011501234",
      avatar: "assets/REEM.jpg"
    },
    "YLY-2023-002": {
      name: "أحمد محمد",
      committee: "HR",
      role: "هيد HR",
      nationalId: "29902021502345",
      avatar: "assets/user-avatar.png"
    },
    "YLY-2023-003": {
      name: "مريم خالد",
      committee: "PR",
      role: "هيد PR",
      nationalId: "30003101503456",
      avatar: "assets/user-avatar.png"
    },
    "YLY-2023-004": {
      name: "علي محمود",
      committee: "OR",
      role: "هيد OR",
      nationalId: "30104211504567",
      avatar: "assets/user-avatar.png"
    }
  };

  // رسائل بيلو
  const biloMessages = {
    welcome: "أهلاً بك في نظام التقييم! هنا يمكنك تقييم أداء المتطوعين بناءً على معايير محددة.",
    addTask: "المهام: 20 نقطة للأداء + 10 نقطة للالتزام بالمواعيد. عند الإعفاء يحصل على نصف النقاط فقط.",
    addEvent: "الفعاليات: 15 نقطة للحضور + 5 نقاط لليونيفورم. عند الإعفاء يحصل على نصف النقاط فقط.",
    saveSuccess: "تأكد من حفظ التقييم بعد الانتهاء لتسجيل النتائج في قاعدة البيانات",
    printTip: "يمكنك طباعة التقييم كملف PDF أو حفظه كسجل رسمي",
    excuseNote: "حدد خانة الإعفاء إذا كان المتطوع لديه عذر مقبول",
    volunteerSelect: "اختر المتطوع من القائمة لبدء عملية التقييم",
    monthSelect: "حدد شهر التقييم المناسب من القائمة المنسدلة",
    evaluationRules: `
      قواعد التقييم:
      1. المهام: 20 (أداء) + 10 (مواعيد)
      2. الفعاليات: 15 (حضور) + 5 (يونيفورم)
      3. الاجتماعات: 10 نقاط لكل اجتماع
      4. التفاعل والأفكار: 15 نقطة
      5. السلوك: 15 نقطة
      6. الإعفاء: يحصل على نصف النقاط فقط
      7. البونص: نقاط إضافية للمتميزين
    `,
    searchHelp: "يمكنك البحث بـ: الاسم - رقم ID - الرقم القومي",
    exportHelp: "سيتم تصدير جميع التقييمات لملف Excel يمكنك فتحه في برنامج Microsoft Excel",
    importHelp: "يمكنك استيراد التقييمات من ملف Excel بشرط أن يكون بنفس تنسيق التصدير",
    contactInfo: "للتواصل مع الدعم الفني: support@yly.com - الهاتف: 0123456789",
    systemRules: `
      قواعد النظام:
      1. التقييم الشهري إجباري لجميع المتطوعين
      2. يجب أن يكون التقييم عادلاً وموضوعياً
      3. لا يمكن تعديل التقييم بعد الحفظ إلا من خلال المسؤول
      4. يحق للمتطوع الاعتراض على التقييم خلال 3 أيام
    `
  };

  // إضافة صف تقييم جديد
  function addEvaluationRow(containerId, rowHtml) {
    const container = document.getElementById(containerId);
    const row = document.createElement('tr');
    row.className = 'evaluation-row';
    row.innerHTML = rowHtml;
    container.appendChild(row);
    
    // إضافة تفاعل لحساب المجاميع عند التغيير
    const inputs = row.querySelectorAll('input');
    inputs.forEach(input => {
      input.addEventListener('input', calculateTotals);
    });
  }

  // حساب المجاميع النهائية
  function calculateTotals() {
    // حساب المهام
    let tasksTotal = 0;
    let deadlineTotal = 0;
    let tasksExcuseCount = 0;
    
    document.querySelectorAll('#tasks-container tr').forEach(row => {
      const isExcused = row.querySelector('.excuse-checkbox').checked;
      const taskPoints = parseInt(row.querySelector('.task-points').value) || 0;
      const deadlinePoints = parseInt(row.querySelector('.deadline-points').value) || 0;
      
      if (isExcused) {
        tasksExcuseCount++;
        tasksTotal += taskPoints / 2;
      } else {
        tasksTotal += taskPoints;
        deadlineTotal += deadlinePoints;
      }
    });
    
    document.getElementById('tasks-total').textContent = Math.min(tasksTotal, 20);
    document.getElementById('deadline-total').textContent = Math.min(deadlineTotal, 10);
    document.getElementById('tasks-excuse-total').textContent = tasksExcuseCount;
    
    // حساب الفعاليات
    let eventsTotal = 0;
    let uniformTotal = 0;
    let eventsExcuseCount = 0;
    
    document.querySelectorAll('#events-container tr').forEach(row => {
      const isExcused = row.querySelector('.excuse-checkbox').checked;
      const eventPoints = parseInt(row.querySelector('.event-points').value) || 0;
      const uniformPoints = parseInt(row.querySelector('.uniform-points').value) || 0;
      
      if (isExcused) {
        eventsExcuseCount++;
        eventsTotal += eventPoints / 2;
      } else {
        eventsTotal += eventPoints;
        uniformTotal += uniformPoints;
      }
    });
    
    document.getElementById('events-total').textContent = Math.min(eventsTotal, 15);
    document.getElementById('uniform-total').textContent = Math.min(uniformTotal, 5);
    document.getElementById('events-excuse-total').textContent = eventsExcuseCount;
    
    // حساب الاجتماعات
    let meetingsTotal = 0;
    let meetingsExcuseCount = 0;
    
    document.querySelectorAll('#meetings-container tr').forEach(row => {
      const isExcused = row.querySelector('.excuse-checkbox').checked;
      const meetingPoints = parseInt(row.querySelector('.meeting-points').value) || 0;
      
      if (isExcused) {
        meetingsExcuseCount++;
        meetingsTotal += meetingPoints / 2;
      } else {
        meetingsTotal += meetingPoints;
      }
    });
    
    document.getElementById('meetings-total').textContent = Math.min(meetingsTotal, 20);
    document.getElementById('meetings-excuse-total').textContent = meetingsExcuseCount;
    
    // حساب التفاعل والأفكار
    const groupActivity = parseInt(document.getElementById('group-activity').value) || 0;
    const hrFollow = parseInt(document.getElementById('hr-follow').value) || 0;
    const ideas = parseInt(document.getElementById('ideas').value) || 0;
    
    // حساب السلوك
    const behavior = parseInt(document.getElementById('behavior').value) || 0;
    const hierarchy = parseInt(document.getElementById('hierarchy').value) || 0;
    
    // حساب البونص
    let bonusTotal = 0;
    document.querySelectorAll('.bonus-points').forEach(input => {
      bonusTotal += parseInt(input.value) || 0;
    });
    
    // المجموع الكلي
    const grandTotal = 
      Math.min(tasksTotal, 20) + 
      Math.min(deadlineTotal, 10) + 
      Math.min(eventsTotal, 15) + 
      Math.min(uniformTotal, 5) + 
      Math.min(meetingsTotal, 20) + 
      Math.min(groupActivity, 5) + 
      Math.min(hrFollow, 5) + 
      Math.min(ideas, 5) + 
      Math.min(behavior, 10) + 
      Math.min(hierarchy, 5) + 
      bonusTotal;
    
    document.getElementById('grand-total').textContent = Math.min(grandTotal, 100);
    
    // حساب التقدير
    calculateGrade(grandTotal);
  }

  // حساب التقدير النهائي
  function calculateGrade(total) {
    let grade = "غير محسوب";
    if (total >= 90) {
      grade = "ممتاز (A)";
      document.getElementById('final-grade').style.color = "var(--success-color)";
    } else if (total >= 80) {
      grade = "جيد جداً (B)";
      document.getElementById('final-grade').style.color = "var(--primary-color)";
    } else if (total >= 70) {
      grade = "جيد (C)";
      document.getElementById('final-grade').style.color = "var(--accent-color)";
    } else if (total >= 60) {
      grade = "مقبول (D)";
      document.getElementById('final-grade').style.color = "var(--warning-color)";
    } else if (total > 0) {
      grade = "ضعيف (F)";
      document.getElementById('final-grade').style.color = "var(--danger-color)";
    }
    
    document.getElementById('final-grade').textContent = grade;
  }

  // حفظ التقييم
  function saveEvaluation() {
    const volunteerId = document.getElementById('volunteer-name').value;
    
    if (!volunteerId) {
      showBiloMessage("يجب اختيار متطوع قبل حفظ التقييم!", "error");
      return;
    }
    
    const evaluationData = {
      volunteerId,
      volunteerName: volunteersData[volunteerId].name,
      month: document.getElementById('evaluation-month').value,
      tasks: [],
      events: [],
      meetings: [],
      groupActivity: parseInt(document.getElementById('group-activity').value) || 0,
      hrFollow: parseInt(document.getElementById('hr-follow').value) || 0,
      ideas: parseInt(document.getElementById('ideas').value) || 0,
      behavior: parseInt(document.getElementById('behavior').value) || 0,
      hierarchy: parseInt(document.getElementById('hierarchy').value) || 0,
      bonuses: [],
      notes: document.getElementById('evaluation-notes').value,
      total: parseInt(document.getElementById('grand-total').textContent) || 0,
      grade: document.getElementById('final-grade').textContent,
      date: new Date().toISOString()
    };
    
    // جمع بيانات المهام
    document.querySelectorAll('#tasks-container tr').forEach(row => {
      evaluationData.tasks.push({
        description: row.querySelector('.task-name').value,
        performancePoints: parseInt(row.querySelector('.task-points').value) || 0,
        deadlinePoints: parseInt(row.querySelector('.deadline-points').value) || 0,
        excused: row.querySelector('.excuse-checkbox').checked
      });
    });
    
    // جمع بيانات الفعاليات
    document.querySelectorAll('#events-container tr').forEach(row => {
      evaluationData.events.push({
        date: row.querySelector('.event-date').value,
        name: row.querySelector('.event-name').value,
        attendancePoints: parseInt(row.querySelector('.event-points').value) || 0,
        uniformPoints: parseInt(row.querySelector('.uniform-points').value) || 0,
        excused: row.querySelector('.excuse-checkbox').checked
      });
    });
    
    // جمع بيانات الاجتماعات
    document.querySelectorAll('#meetings-container tr').forEach(row => {
      evaluationData.meetings.push({
        date: row.querySelector('.meeting-date').value,
        type: row.querySelector('.meeting-type').value,
        points: parseInt(row.querySelector('.meeting-points').value) || 0,
        excused: row.querySelector('.excuse-checkbox').checked
      });
    });
    
    // جمع بيانات البونص
    document.querySelectorAll('.bonus-item').forEach(item => {
      evaluationData.bonuses.push({
        description: item.querySelector('.bonus-name').value,
        points: parseInt(item.querySelector('.bonus-points').value) || 0
      });
    });
    
    // هنا سيتم إرسال البيانات إلى الخادم
    console.log("بيانات التقييم المحفوظة:", evaluationData);
    showBiloMessage("تم حفظ التقييم بنجاح!", "success");
    
    // عرض بيانات التقييم (يمكن حذفها في الإنتاج)
    alert(`تم تقييم ${evaluationData.volunteerName}\nالمجموع: ${evaluationData.total}/100\nالتقدير: ${evaluationData.grade}`);
  }

  // طباعة التقييم
  function printEvaluation() {
    const volunteerName = document.getElementById('volunteer-name').options[document.getElementById('volunteer-name').selectedIndex].text;
    if (!volunteerName || volunteerName.includes("اختر")) {
      showBiloMessage("يجب اختيار متطوع قبل الطباعة!", "error");
      return;
    }
    
    showBiloMessage("جاري تحضير التقييم للطباعة...", "info");
    setTimeout(() => {
      window.print();
    }, 500);
  }

  // مشاركة التقييم
  function shareEvaluation() {
    const volunteerId = document.getElementById('volunteer-name').value;
    if (!volunteerId) {
      showBiloMessage("يجب اختيار متطوع قبل المشاركة!", "error");
      return;
    }
    
    const volunteerName = volunteersData[volunteerId].name;
    const month = document.getElementById('evaluation-month').options[document.getElementById('evaluation-month').selectedIndex].text;
    const total = document.getElementById('grand-total').textContent;
    const grade = document.getElementById('final-grade').textContent;
    
    const shareText = `تقييم ${volunteerName} - شهر ${month}\n\n` +
                     `المجموع النهائي: ${total}/100\n` +
                     `التقدير: ${grade}\n\n` +
                     `تم التقييم عبر نظام YLY`;
    
    if (navigator.share) {
      navigator.share({
        title: `تقييم ${volunteerName}`,
        text: shareText
      }).catch(err => {
        console.error('Error sharing:', err);
        fallbackShare(shareText);
      });
    } else {
      fallbackShare(shareText);
    }
  }

  // طريقة بديلة للمشاركة
  function fallbackShare(shareText) {
    navigator.clipboard.writeText(shareText).then(() => {
      showBiloMessage("تم نسخ التقييم إلى الحافظة، يمكنك مشاركته الآن", "success");
    }).catch(err => {
      console.error('Could not copy text: ', err);
      showBiloMessage("يمكنك مشاركة التقييم يدوياً عن طريق نسخ البيانات", "info");
    });
  }

  // تصدير التقييمات لملف Excel
  function exportEvaluations() {
    showBiloMessage("جاري تصدير التقييمات لملف Excel...", "info");
    
    // في الواقع، هنا سيتم الاتصال بالخادم لإنشاء الملف
    setTimeout(() => {
      showBiloMessage("تم تصدير التقييمات بنجاح! سيبدأ التنزيل تلقائياً", "success");
      
      // محاكاة عملية التصدير (في الواقع سيتم استبدال هذا بالاتصال بالخادم)
      const link = document.createElement('a');
      link.href = 'data:text/csv;charset=utf-8,' + encodeURIComponent("مثال على بيانات التقييمات");
      link.download = `تقييمات_YLY_${new Date().toLocaleDateString()}.xlsx`;
      link.click();
    }, 1500);
  }

  // استيراد التقييمات من ملف Excel
  function importEvaluations() {
    showBiloMessage("حدد ملف Excel الذي يحتوي على التقييمات", "info");
    
    // في الواقع، هنا سيتم رفع الملف للخادم
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.xlsx,.xls,.csv';
    
    input.onchange = e => {
      const file = e.target.files[0];
      if (file) {
        showBiloMessage(`جاري استيراد التقييمات من ملف ${file.name}...`, "info");
        
        setTimeout(() => {
          showBiloMessage("تم استيراد التقييمات بنجاح!", "success");
        }, 2000);
      }
    };
    
    input.click();
  }

  // إضافة بونص جديد
  document.getElementById('add-bonus-btn').addEventListener('click', function() {
    const bonusId = Date.now();
    const bonusHtml = `
      <div class="form-group bonus-item" data-id="${bonusId}">
        <div class="bonus-controls">
          <input type="text" class="form-control bonus-name" placeholder="وصف البونص"
                 onmouseover="showBiloMessage('أدخل وصفاً واضحاً للبونص (مثل: مبادرة مميزة - أداء استثنائي)', 'info')"
                 onmouseout="hideBiloMessage()">
          <input type="number" class="form-control bonus-points" min="0" value="0"
                 onmouseover="showBiloMessage('عدد نقاط البونص الإضافية (عادة من 1 إلى 5 نقاط)', 'info')"
                 onmouseout="hideBiloMessage()">
          <button type="button" class="remove-bonus" onclick="removeBonus(${bonusId})"
                  onmouseover="showBiloMessage('إزالة هذا البونص', 'danger')"
                  onmouseout="hideBiloMessage()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
    `;
    document.getElementById('bonus-container').insertAdjacentHTML('beforeend', bonusHtml);
    
    // إضافة تفاعل لحساب المجاميع عند التغيير
    const inputs = document.querySelector(`.bonus-item[data-id="${bonusId}"]`).querySelectorAll('input');
    inputs.forEach(input => {
      input.addEventListener('input', calculateTotals);
    });
  });

  // إزالة بونص
  function removeBonus(bonusId) {
    document.querySelector(`.bonus-item[data-id="${bonusId}"]`).remove();
    calculateTotals();
  }

  // عرض رسالة بيلو
  let biloTimeout;
  function showBiloMessage(message, type = "info") {
    const biloImg = document.getElementById('bilo-img');
    const speech = document.getElementById('bilo-speech');
    
    // تغيير صورة بيلو حسب نوع الرسالة
    switch(type) {
      case "error":
        biloImg.src = 'assets/bilo-huzn.png';
        break;
      case "success":
        biloImg.src = 'assets/bilo-andihem.png';
        break;
      case "warning":
        biloImg.src = 'assets/bilo-biejrey.png';
        break;
      default:
        biloImg.src = 'assets/bilo-happy.png';
    }
    
    speech.textContent = message;
    speech.classList.add('show');
    
    clearTimeout(biloTimeout);
    biloTimeout = setTimeout(() => {
      speech.classList.remove('show');
    }, 7000);
  }

  // إخفاء رسالة بيلو
  function hideBiloMessage() {
    const speech = document.getElementById('bilo-speech');
    if (!event?.relatedTarget?.closest('.bilo-container')) {
      speech.classList.remove('show');
    }
  }

  // تفاعل النقر على بيلو
  function biloClick() {
    const tips = [
      "تذكر أن التقييم العادل يساعد في تطوير أداء المتطوعين",
      "يمكنك تصدير التقييمات لمشاركتها مع الإدارة العليا",
      "الإعفاءات تخفض النقاط إلى النصف ولكنها تحفظ حقوق المتطوعين",
      "التقييم الدقيق يساعد في اختيار أفضل المتطوعين للمهام القادمة",
      biloMessages.evaluationRules,
      biloMessages.searchHelp,
      biloMessages.exportHelp,
      biloMessages.importHelp
    ];
    const randomTip = tips[Math.floor(Math.random() * tips.length)];
    showBiloMessage(randomTip);
  }

  // إعداد أزرار الإضافة
  document.getElementById('add-task-btn').addEventListener('click', function() {
    addEvaluationRow('tasks-container', `
      <td><input type="text" class="form-control task-name" placeholder="وصف المهمة"
                 onmouseover="showBiloMessage('أدخل وصفاً واضحاً للمهمة المكلف بها المتطوع', 'info')"
                 onmouseout="hideBiloMessage()"></td>
      <td><input type="number" class="form-control task-points" min="0" max="20" value="0"
                 onmouseover="showBiloMessage('تقييم أداء المتطوع في تنفيذ المهمة من 20 نقطة', 'info')"
                 onmouseout="hideBiloMessage()"></td>
      <td><input type="number" class="form-control deadline-points" min="0" max="10" value="0"
                 onmouseover="showBiloMessage('تقييم التزام المتطوع بالمواعيد المحددة من 10 نقاط', 'info')"
                 onmouseout="hideBiloMessage()"></td>
      <td><input type="checkbox" class="excuse-checkbox"
                 onmouseover="showBiloMessage('حدد إذا كان المتطوع لديه عذر مقبول (يحصل على نصف النقاط)', 'warning')"
                 onmouseout="hideBiloMessage()"></td>
      <td>
        <button type="button" class="action-btn delete" onclick="this.closest('tr').remove(); calculateTotals();"
                onmouseover="showBiloMessage('حذف هذه المهمة من التقييم', 'danger')"
                onmouseout="hideBiloMessage()">
          <i class="fas fa-trash"></i>
        </button>
      </td>
    `);
  });

  document.getElementById('add-event-btn').addEventListener('click', function() {
    addEvaluationRow('events-container', `
      <td><input type="date" class="form-control event-date"
                 onmouseover="showBiloMessage('حدد تاريخ الفعالية التي حضرها المتطوع', 'info')"
                 onmouseout="hideBiloMessage()"></td>
      <td><input type="text" class="form-control event-name" placeholder="اسم الفعالية"
                 onmouseover="showBiloMessage('أدخل اسم الفعالية أو الحدث الذي حضره المتطوع', 'info')"
                 onmouseout="hideBiloMessage()"></td>
      <td><input type="number" class="form-control event-points" min="0" max="15" value="0"
                 onmouseover="showBiloMessage('تقييم حضور المتطوع للفعالية وتفاعله فيها من 15 نقطة', 'info')"
                 onmouseout="hideBiloMessage()"></td>
      <td><input type="number" class="form-control uniform-points" min="0" max="5" value="0"
                 onmouseover="showBiloMessage('تقييم التزام المتطوع باليونيفورم الرسمي من 5 نقاط', 'info')"
                 onmouseout="hideBiloMessage()"></td>
      <td><input type="checkbox" class="excuse-checkbox"
                 onmouseover="showBiloMessage('حدد إذا كان المتطوع لديه عذر مقبول لغيابه (يحصل على نصف النقاط)', 'warning')"
                 onmouseout="hideBiloMessage()"></td>
      <td>
        <button type="button" class="action-btn delete" onclick="this.closest('tr').remove(); calculateTotals();"
                onmouseover="showBiloMessage('حذف هذه الفعالية من التقييم', 'danger')"
                onmouseout="hideBiloMessage()">
          <i class="fas fa-trash"></i>
        </button>
      </td>
    `);
  });

  document.getElementById('add-meeting-btn').addEventListener('click', function() {
    addEvaluationRow('meetings-container', `
      <td><input type="date" class="form-control meeting-date"
                 onmouseover="showBiloMessage('حدد تاريخ الاجتماع الذي حضره المتطوع', 'info')"
                 onmouseout="hideBiloMessage()"></td>
      <td><input type="text" class="form-control meeting-type" placeholder="نوع الاجتماع"
                 onmouseover="showBiloMessage('أدخل نوع الاجتماع (إسبوعي - طارئ - تخطيطي)', 'info')"
                 onmouseout="hideBiloMessage()"></td>
      <td><input type="number" class="form-control meeting-points" min="0" max="10" value="0"
                 onmouseover="showBiloMessage('تقييم حضور المتطوع للاجتماع وتفاعله فيه من 10 نقاط', 'info')"
                 onmouseout="hideBiloMessage()"></td>
      <td><input type="checkbox" class="excuse-checkbox"
                 onmouseover="showBiloMessage('حدد إذا كان المتطوع لديه عذر مقبول لغيابه (يحصل على نصف النقاط)', 'warning')"
                 onmouseout="hideBiloMessage()"></td>
      <td>
        <button type="button" class="action-btn delete" onclick="this.closest('tr').remove(); calculateTotals();"
                onmouseover="showBiloMessage('حذف هذا الاجتماع من التقييم', 'danger')"
                onmouseout="hideBiloMessage()">
          <i class="fas fa-trash"></i>
        </button>
      </td>
    `);
  });

  // إعداد أزرار التحكم
  document.getElementById('save-evaluation').addEventListener('click', saveEvaluation);
  document.getElementById('print-evaluation').addEventListener('click', printEvaluation);
  document.getElementById('share-evaluation').addEventListener('click', shareEvaluation);
  document.getElementById('export-evaluations').addEventListener('click', exportEvaluations);
  document.getElementById('import-evaluations').addEventListener('click', importEvaluations);
  document.getElementById('clear-form').addEventListener('click', function() {
    if (confirm('هل أنت متأكد من مسح النموذج الحالي؟ سيتم فقدان جميع البيانات غير المحفوظة.')) {
      document.getElementById('evaluation-form').reset();
      document.getElementById('tasks-container').innerHTML = '';
      document.getElementById('events-container').innerHTML = '';
      document.getElementById('meetings-container').innerHTML = '';
      document.getElementById('bonus-container').innerHTML = '';
      calculateTotals();
      showBiloMessage("تم مسح النموذج بنجاح، يمكنك البدء بتقييم جديد", "success");
    }
  });

  // حساب المجاميع عند أي تغيير في النموذج
  document.getElementById('evaluation-form').addEventListener('input', calculateTotals);
</script>
</body>
</html>